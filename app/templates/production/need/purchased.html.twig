{% extends 'base.html.twig' %}

{% block title %}Потребность материалов и покупных деталей: <small>по плану производства № {{ productionPlan.idErp }} от {{ productionPlan.dateErp|date("d.m.Y") }} - {{ accountTypes[productionPlan.accountType] }}, дата производства с {{ productionPlan.dateBeginErp|date("d.m.Y") }} - по {{ productionPlan.dateEndErp|date("d.m.Y") }} </small>{% endblock %}

{% block body %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <!-- /.card-header -->
            <div class="card-body">
                <table id="need-category-purchaseds" class="table table-bordered table-striped table-hover table-sm">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Код</th>
                            <th>Обозначение</th>
                            <th>Наименование</th>
                            <th>Ед.изм.</th>
                            <th>Кол-во для плана</th>
                            <th>Остаток на складе закупок</th>
                            <th>Остаток на производстве</th>
                            <th>Итого к закупке</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                        <tr>
                            <th></th>
                            <th>Код</th>
                            <th>Обозначение</th>
                            <th>Наименование</th>
                            <th>Ед.изм.</th>
                            <th>Кол-во для плана</th>
                            <th>Остаток на складе закупок</th>
                            <th>Остаток на производстве</th>
                            <th>Итого к закупке</th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
    <!-- /.col -->
</div>
<!-- /.row -->

{% endblock %}


{% block javascripts %}
<script>
    $(function () {
        let table = $("#need-category-purchaseds").DataTable({
            "columnDefs": [
                {
                    'render': function (data, type, row) {
                        symbol = '';
                        if (row["prefix"] === 'pr') {
                            symbol = '<i class="fas fa fa-cube nav-icon"></i>';
                        } else if (row["prefix"] === 'mt') {
                            symbol = '<i class="fas fa fa-leaf nav-icon"></i>';
                        }
                        return symbol;
                    },
                    "name": "symbol",
                    "targets": 0
                },
                {
                    'render': function (data, type, row) {
                        let urlShow = '';
                        if (row["prefix"] === 'pr') {
                            urlShow = "{{ path('product_show', { 'id': 0 }) }}";
                        } else if (row["prefix"] === 'mt') {
                            urlShow = "{{ path('material_show', { 'id': 0 }) }}";
                        }

                        urlShow = urlShow.replace("0", row["product_id"]);
                        return "<a href='" + urlShow + "' class='float-left' target='_blank'>" + row["product_id"] + "</a>";
                    },
                    "name": "product_id",
                    "targets": 1
                },
                {
                    'render': function (data, type, row) {
                        return row["designation"];
                    },
                    "name": "designation",
                    "targets": 2
                },
                {
                    'render': function (data, type, row) {
                        return row["name"];
                    },
                    "name": "name",
                    "targets": 3
                },
                {
                    'render': function (data, type, row) {
                        return row["unit"];
                    },
                    "name": "unit",
                    "targets": 4
                },
                {
                    'render': function (data, type, row) {
                        return row["amount_all"];
                    },
                    "name": "amount_all",
                    "targets": 5
                },
                {
                    'render': function (data, type, row) {
                        return row["balance_buy"];
                    },
                    "name": "balance_buy",
                    "targets": 6
                },
                {
                    'render': function (data, type, row) {
                        return row["balance_manufacture"];
                    },
                    "name": "balance_manufacture",
                    "targets": 7
                },
                {
                    'render': function (data, type, row) {
                        return row["amount_result"];
                    },
                    "name": "amount_result",
                    "className": "table-cell-edit",
                    "targets": 8
                },
                {
                    'render': function (data, type, row) {

                        let urlShow = "{{ path('production_plan_need_purchased_product', { 'production_plan_id': '0pl', 'id': '0pr' }) }}";
                        urlShow = urlShow.replace('0pl', "{{ productionPlan.id }}");
                        urlShow = urlShow.replace('0pr', row["product_id"]);

                        let buttonShow = "<a href='" + urlShow + "' class='btn btn-secondary' title='Подробнее' target='_blank'><i class='fas fa-eye'></i></a>";

                        return "<div class='btn-group btn-group-sm'>" + buttonShow + "</div>";
                    },
                    "name": "root",
                    "targets": 9,
                    "orderable": false
                },
            ],
            "ajax": {
                "url": "{{ path('datatable_plan_need_purchaseds', {'production_plan_id': productionPlan.id}) }}",
                "type": "POST"
            },
            "stateSave": true,
            "processing": true,
            "serverSide": true,
            "responsive": true,
            "autoWidth": false,
            "paging": true,
            "info": true,
            "searching": true,
            "pageLength": 25,
            "order": [[1, 'desc']],
            "language": {
                "url": "{{ asset('dist/json/dataTables.ru.lang.json') }}"
            }
        });

    });
</script>

{% endblock %}